@section Javascripts
{
    <script type="text/javascript" src="@Url.Content("~/bower_components/moment/min/moment.min.js")"></script>
}
<script type="text/javascript">
    $(document).ready(function () {
        $('#from-PurchasedSerial').bootstrapValidator({
            fields: {
                ProductNo: {
                    validators: {
                        notEmpty: {
                            message: '品號不能為空！'
                        }
                    }
                },
                SerialNo: {
                    validators: {
                        notEmpty: {
                            message: '序號不能為空！'
                        },
                        callback: {
                            message: '輸入的商品序號已存在，請重新輸入!',
                            callback: function (value, validator) {
                                var res = true;
                                if (value != "") {
                                    $.ajax({
                                        url: '@Url.Action("SerialNo", "Main")',
                                        data: JSON.stringify({ "SerialNo": value }),
                                        type: 'POST',
                                        async: false,
                                        contentType: 'application/json; charset=utf-8',
                                        success: function (data) {
                                            if (data == false) {
                                                res = false;
                                            }
                                        }
                                    })
                                }
                                return res;
                            }
                        }
                    }
                }
            }
        });

        $("#id_OrderDate").datetimepicker({
            format: 'yyyy/mm/dd',
            autoclose: 1,
            forceParse: 1,
            startView: 2,
            minView: 2,
            todayBtn: 1,
            todayHighlight: 1
        });

        $("#id_SaleDate").datetimepicker({
            format: 'yyyy/mm/dd',
            autoclose: 1,
            forceParse: 1,
            startView: 2,
            minView: 2,
            todayBtn: 1,
            todayHighlight: 1
        });

        $("#id_ConfirmedDate").datetimepicker({
            format: 'yyyy/mm/dd',
            autoclose: 1,
            forceParse: 1,
            startView: 2,
            minView: 2,
            todayBtn: 1,
            todayHighlight: 1
        });

        $("#id_WarrantySDate").datetimepicker({
            format: 'yyyy/mm/dd',
            autoclose: 1,
            forceParse: 1,
            startView: 2,
            minView: 2,
            todayBtn: 1,
            todayHighlight: 1
        });

        $("#id_WarrantyEDate").datetimepicker({
            format: 'yyyy/mm/dd',
            autoclose: 1,
            forceParse: 1,
            startView: 2,
            minView: 2,
            todayBtn: 1,
            todayHighlight: 1
        });
    });

    $(function () {
        $('#id_SerArrangeOrderType').blur(function () {
            if (document.getElementById("id_SerArrangeOrderType").readOnly == true) {
                return;
            }
            if ($("#id_SerArrangeOrderType").val().trim() != "") {
                $.ajax({
                    url: '@Url.Action("GetOrderTypeName", "Main", new { Area = "CONI01" })',
                    data: JSON.stringify({ "OrderType": $("#id_SerArrangeOrderType").val().trim(), "OrderCategory": "D1" }),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $('#ordersname').text(data.OrderSName);
                        $('#AutoConfirm').val(data.AutoConfirm);
                        $('#CheckExOrder').val(data.CheckExOrder);
                        $.ajax({
                            url: '@Url.Action("GetOrderTypeNo", "Main",new { Area = "SUPI05"})',
                            data: JSON.stringify({ "OrderType": $("#id_SerArrangeOrderType").val().trim() }),
                            type: 'POST',
                            contentType: 'application/json; charset=utf-8',
                            success: function (data) {
                                var strData = data.split('-');
                                if (strData[0] == "YES") {
                                    $('#id_SerArrangeOrderNo').val(strData[1]);
                                    if(strData[1]=="")
                                    {
                                        document.getElementById("id_SerArrangeOrderNo").readOnly = "";
                                    }else
                                    {
                                        document.getElementById("id_SerArrangeOrderNo").readOnly = "readonly";
                                    }
                                } else if (strData[0] == "NO") {
                                    $('#id_SerArrangeOrderNo').val(strData[1]);
                                    document.getElementById("id_SerArrangeOrderNo").readOnly = "";
                                } else {
                                    $("#msg_information").html(strData[1]);
                                    document.getElementById("id_SerArrangeOrderNo").readOnly = "";
                                    $('.msg-modal-lg').modal();
                                }
                            }
                        })
                    },
                    error: function () {
                        $("#msg_information").html("單別不存在！");
                        $('.msg-modal-lg').modal();
                        $("#id_SerArrangeOrderType").val("")
                        $('#ordersname').text("");
                        $('#id_SerArrangeOrderNo').val("");
                        $('#AutoConfirm').val("");
                        $('#CheckExOrder').val("");
                        return;
                    }
                })
            } else {
                $('#ordersname').text("");
                $("#id_SerArrangeOrderType").val("")
                $('#ordersname').text("");
                $('#id_SerArrangeOrderNo').val("");
                document.getElementById("id_SerArrangeOrderNo").readOnly = "";
            }
        });

        $('#id_CustomerId').blur(function () {
            if (document.getElementById("id_CustomerId").readOnly == true) {
                return;
            }
            if ($("#id_CustomerId").val().trim() != "") {
                $.ajax({
                    url: '@Url.Action("SearchCustomerInfo", "Main", new { Area = "CONI02" })',
                    data: JSON.stringify({ "CustomerId": $("#id_CustomerId").val().trim() }),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        if (data != "")
                        {
                            $("#id_CustomerId").val(data.CustomerId);        //客戶代號
                            $("#customername").html(data.CustomerName);     //客戶名稱
                            $("#id_CustomerType").val(data.CustomerType);     //客戶形態
                            $("#id_SourceOrderType").val("");      //來源單別
                            $("#id_SourceOrderNo").val("");    //來源單號
                            $("#id_SourceOrderItemId").val("");    //來源項次
                            $("#id_SerialNo").val("");      //序號
                            $("#id_ProductNo").val("");    //品號
                            $("#id_ProductName").val("");    //品名
                            $("#id_RoutineServiceFreq").val("");    //定期保養
                            $("#id_WarrantyPeriod").val("");    //保固期限
                            $("#id_WarrantySDate").val("");    //保固起日
                            $("#id_WarrantyEDate").val("");    //保固迄日
                        }else
                        {
                            $("#msg_information").html("客戶不存在！");
                            $('.msg-modal-lg').modal();
                            $("#id_CustomerId").val("");        //客戶代號
                            $("#customername").html("");     //客戶名稱
                            $("#id_CustomerType").val("");     //客戶形態
                            $("#id_SourceOrderType").val("");      //來源單別
                            $("#id_SourceOrderNo").val("");    //來源單號
                            $("#id_SourceOrderItemId").val("");    //來源項次
                            $("#id_SerialNo").val("");      //序號
                            $("#id_ProductNo").val("");    //品號
                            $("#id_ProductName").val("");    //品名
                            $("#id_RoutineServiceFreq").val("");    //定期保養
                            $("#id_WarrantyPeriod").val("");    //保固期限
                            $("#id_WarrantySDate").val("");    //保固起日
                            $("#id_WarrantyEDate").val("");    //保固迄日
                            return;
                        }

                    },
                    error: function () {
                        $("#msg_information").html("客戶不存在！");
                        $('.msg-modal-lg').modal();
                        $("#id_CustomerId").val("");        //客戶代號
                        $("#customername").html("");     //客戶名稱
                        $("#id_CustomerType").val("");     //客戶形態
                        $("#id_SourceOrderType").val("");      //來源單別
                        $("#id_SourceOrderNo").val("");    //來源單號
                        $("#id_SourceOrderItemId").val("");    //來源項次
                        $("#id_SerialNo").val("");      //序號
                        $("#id_ProductNo").val("");    //品號
                        $("#id_ProductName").val("");    //品名
                        $("#id_RoutineServiceFreq").val("");    //定期保養
                        $("#id_WarrantyPeriod").val("");    //保固期限
                        $("#id_WarrantySDate").val("");    //保固起日
                        $("#id_WarrantyEDate").val("");    //保固迄日
                        return;
                    }
                })
            } else {
                $("#id_CustomerId").val("");        //客戶代號
                $("#customername").html("");     //客戶名稱
                $("#id_CustomerType").val("");     //客戶形態
                $("#id_SourceOrderType").val("");      //來源單別
                $("#id_SourceOrderNo").val("");    //來源單號
                $("#id_SourceOrderItemId").val("");    //來源項次
                $("#id_SerialNo").val("");      //序號
                $("#id_ProductNo").val("");    //品號
                $("#id_ProductName").val("");    //品名
                $("#id_RoutineServiceFreq").val("");    //定期保養
                $("#id_WarrantyPeriod").val("");    //保固期限
                $("#id_WarrantySDate").val("");    //保固起日
                $("#id_WarrantyEDate").val("");    //保固迄日
            }
        });

        @*$("#btnCustomerId").click(function () {
            $.ajax({
                url: '@Url.Action("SearchCustomer", "Main", new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "CustomerId": $("#id_CustomerId").val().trim(), "Col": "", "Condition": "", "conditionValue": "", Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divCustGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divCustGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectCustomer(this)'>選擇</a>" +
                                "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                "<td class='ContactType'>" + Maintain[i].Contact + "</td>" +
                                "<td class='TelNoType'>" + Maintain[i].TelNo + "</td>" +
                                "<td class='SalesType'>" + Maintain[i].SalesName + "</td><td><input type='hidden' class='SalesIDType' name='sales' value='"
                                + Maintain[i].Sales + "'>" + "</td>" +
                                "<td><input type='hidden' class='CurrencyIdType' name='version' value='" + Maintain[i].CurrencyId + "'>" + "</td>" +
                                "<td><input type='hidden' class='TaxRateType' name='version' value='" + Maintain[i].TaxRate + "'>" + "</td>" +
                                "<td><input type='hidden' class='FaxNoType' name='version' value='" + Maintain[i].FaxNo + "'>" + "</td>" +
                                "<td><input type='hidden' class='EmailType' name='version' value='" + Maintain[i].Email + "'>" + "</td>" +
                                "<td><input type='hidden' class='AddressSNameType' name='version' value='" + Maintain[i].AddressSName + "'>" + "</td>" +
                                "<td><input type='hidden' class='AddressType' name='version' value='" + Maintain[i].Address + "'>" + "</td>" +
                                "<td><input type='hidden' class='RemarkType' name='version' value='" + Maintain[i].Remark + "'>" + "</td>" +
                                "<td><input type='hidden' class='CustomerFNameType' name='version' value='" + Maintain[i].CustomerFName + "'>" + "</td>" +
                                "</tr>");

                    }
                }
            });
            $("#txtCustomerId").val("");
            $("#txtCustomerName").val("");
            $("#CustPage").val("1");
            $(".



            ").modal();
        });

        $("#btncustomerInfo").click(function () {
            $.ajax({
                url: '@Url.Action("SearchCustomer", "Main", new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "CustomerId": $("#txtCustomerId").val(), "Col": $("#addCustomer_Col").val(), "Condition": $("#addCustomer_Condition").val(), "conditionValue": $("#addCustomer_conditionValue").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divCustGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divCustGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectCustomer(this)'>選擇</a>" +
                                "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                "<td class='ContactType'>" + Maintain[i].Contact + "</td>" +
                                "<td class='TelNoType'>" + Maintain[i].TelNo + "</td>" +
                                "<td class='SalesType'>" + Maintain[i].SalesName + "</td><td><input type='hidden' class='SalesIDType' name='sales' value='"
                                + Maintain[i].Sales + "'>" + "</td>" +
                                "<td><input type='hidden' class='CurrencyIdType' name='version' value='" + Maintain[i].CurrencyId + "'>" + "</td>" +
                                "<td><input type='hidden' class='TaxRateType' name='version' value='" + Maintain[i].TaxRate + "'>" + "</td>" +
                                "<td><input type='hidden' class='FaxNoType' name='version' value='" + Maintain[i].FaxNo + "'>" + "</td>" +
                                "<td><input type='hidden' class='EmailType' name='version' value='" + Maintain[i].Email + "'>" + "</td>" +
                                "<td><input type='hidden' class='AddressSNameType' name='version' value='" + Maintain[i].AddressSName + "'>" + "</td>" +
                                "<td><input type='hidden' class='AddressType' name='version' value='" + Maintain[i].Address + "'>" + "</td>" +
                                "<td><input type='hidden' class='RemarkType' name='version' value='" + Maintain[i].Remark + "'>" + "</td>" +
                                "<td><input type='hidden' class='CustomerFNameType' name='version' value='" + Maintain[i].CustomerFName + "'>" + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#CustPage").val("1");
        });

        $("#divCustGrid").scroll(function () {
            var Page = document.getElementById("CustPage").value;;
            if (Page != 0) {
                var scrollTop = $(this).scrollTop();
                //var scrollHeight = $(document).height();
                //var windowHeight = $(this).height();
                if (scrollTop + 500 >= (870 - 370) * (Page - 1)) {
                    //此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
                    Page = parseInt(Page) + 1;
                    $.ajax({
                        url: '@Url.Action("SearchCustomer", "Main", new { Area = "CONI02" })',
                        type: "POST",
                        datatype: 'JSON',
                        data: JSON.stringify({ "CustomerId": $("#txtCustomerId").val(), "Col": $("#addCustomer_Col").val(), "Condition": $("#addCustomer_Condition").val(), "conditionValue": $("#addCustomer_conditionValue").val(), Page: Page }),
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            var Maintain = eval(data);
                            for (var i = 0; i < Maintain.length; i++) {
                                $("#divCustGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectCustomer(this)'>選擇</a>" +
                                "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                "<td class='ContactType'>" + Maintain[i].Contact + "</td>" +
                                "<td class='TelNoType'>" + Maintain[i].TelNo + "</td>" +
                                "<td class='SalesType'>" + Maintain[i].SalesName + "</td><td><input type='hidden' class='SalesIDType' name='sales' value='"
                                + Maintain[i].Sales + "'>" + "</td>" +
                                "<td><input type='hidden' class='CurrencyIdType' name='version' value='" + Maintain[i].CurrencyId + "'>" + "</td>" +
                                "<td><input type='hidden' class='TaxRateType' name='version' value='" + Maintain[i].TaxRate + "'>" + "</td>" +
                                "<td><input type='hidden' class='FaxNoType' name='version' value='" + Maintain[i].FaxNo + "'>" + "</td>" +
                                "<td><input type='hidden' class='EmailType' name='version' value='" + Maintain[i].Email + "'>" + "</td>" +
                                "<td><input type='hidden' class='AddressSNameType' name='version' value='" + Maintain[i].AddressSName + "'>" + "</td>" +
                                "<td><input type='hidden' class='AddressType' name='version' value='" + Maintain[i].Address + "'>" + "</td>" +
                                "<td><input type='hidden' class='RemarkType' name='version' value='" + Maintain[i].Remark + "'>" + "</td>" +
                                "<td><input type='hidden' class='CustomerFNameType' name='version' value='" + Maintain[i].CustomerFName + "'>" + "</td>" +
                                "</tr>");
                            }
                        }
                    });
                    $("#CustPage").val(Page);
                }
            }

        });*@

        $("#btnSourceOrder").click(function () {
            $.ajax({
                url: '@Url.Action("SearchContract", "Main", new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "ContractType": "", "ContractNo": "", "CustomerId": $("#id_CustomerId").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divContractGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divContractGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectContractType(this)'>選擇</a>" +
                                "<td class='ContractTypeType'>" + Maintain[i].ContractType + "</td>" +
                                "<td class='OrderSNameType'>" + Maintain[i].OrderSName + "</td>" +
                                "<td class='ContractNoType'>" + Maintain[i].ContractNo + "</td>" +
                                "<td class='VersionType'>" + Maintain[i].Version + "</td>" +
                                "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                "<td class='ConfirmedDateType'>" + Maintain[i].ConfirmedDate + "</td>" +
                                "<td class='ContractSDateType'>" + Maintain[i].ContractSDate + "</td>" +
                                "<td class='ContractEDateType'>" + Maintain[i].ContractEDate + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#txtContractType").val("");
            $("#txtContractNo").val("");
            $("#ContractPage").val("1");
            $(".record-selector-contract-modal").modal();

        });

        $("#btnSelectContract").click(function () {
            $.ajax({
                url: '@Url.Action("SearchContract", "Main", new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "ContractType": $("#txtContractType").val(), "ContractNo": $("#txtContractNo").val(), "CustomerId": $("#id_CustomerId").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divContractGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divContractGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectContractType(this)'>選擇</a>" +
                                "<td class='ContractTypeType'>" + Maintain[i].ContractType + "</td>" +
                                "<td class='OrderSNameType'>" + Maintain[i].OrderSName + "</td>" +
                                "<td class='ContractNoType'>" + Maintain[i].ContractNo + "</td>" +
                                "<td class='VersionType'>" + Maintain[i].Version + "</td>" +
                                "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                "<td class='ConfirmedDateType'>" + Maintain[i].ConfirmedDate + "</td>" +
                                "<td class='ContractSDateType'>" + Maintain[i].ContractSDate + "</td>" +
                                "<td class='ContractEDateType'>" + Maintain[i].ContractEDate + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#ContractPage").val("1");
        });

        $("#divContractGrid").scroll(function () {
            var Page = document.getElementById("ContractPage").value;;
            if (Page != 0) {
                var scrollTop = $(this).scrollTop();
                //var scrollHeight = $(document).height();
                //var windowHeight = $(this).height();
                if (scrollTop + 500 >= (870 - 370) * (Page - 1)) {
                    //此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
                    Page = parseInt(Page) + 1;
                    $.ajax({
                        url: '@Url.Action("SearchContract", "Main", new { Area = "CONI02" })',
                        type: "POST",
                        datatype: 'JSON',
                        data: JSON.stringify({ "ContractType": $("#txtContractType").val(), "ContractNo": $("#txtContractNo").val(), "CustomerId": $("#id_CustomerId").val(), Page: Page }),
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            var Maintain = eval(data);
                            for (var i = 0; i < Maintain.length; i++) {
                                $("#divContractGrid table tbody").append("<tr>" +
                                    "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectContractType(this)'>選擇</a>" +
                                    "<td class='ContractTypeType'>" + Maintain[i].ContractType + "</td>" +
                                    "<td class='OrderSNameType'>" + Maintain[i].OrderSName + "</td>" +
                                    "<td class='ContractNoType'>" + Maintain[i].ContractNo + "</td>" +
                                    "<td class='VersionType'>" + Maintain[i].Version + "</td>" +
                                    "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                    "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                    "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                    "<td class='ConfirmedDateType'>" + Maintain[i].ConfirmedDate + "</td>" +
                                    "<td class='ContractSDateType'>" + Maintain[i].ContractSDate + "</td>" +
                                    "<td class='ContractEDateType'>" + Maintain[i].ContractEDate + "</td>" +
                                    "</tr>");
                            }
                        }
                    });
                    $("#ContractPage").val(Page);
                }
            }
        });

        $("#btnCopyOrder").click(function () {
            $.ajax({
                url: '@Url.Action("SearchContractProduct", "Main", new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "Col": "", "ContractNo": "", "ItemId": "", Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divContractproductGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divContractproductGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectContractProductType(this)'>選擇</a>" +
                                "<td class='ContractTypeType'>" + Maintain[i].ContractType + "</td>" +
                                "<td class='OrderSNameType'>" + Maintain[i].OrderSName + "</td>" +
                                "<td class='ContractNoType'>" + Maintain[i].ContractNo + "</td>" +
                                "<td class='ItemIdType'>" + Maintain[i].ItemId + "</td>" +
                                "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                "<td class='SerialNoType'>" + Maintain[i].SerialNo + "</td>" +
                                "<td class='WarrantyPeriodType'>" + Maintain[i].WarrantyPeriod + "</td>" +
                                "<td class='WarrantySDateType'>" + Maintain[i].WarrantySDate + "</td>" +
                                "<td class='WarrantyEDateType'>" + Maintain[i].WarrantyEDate + "</td>" +
                                "<td class='RoutineServiceFreqType'>" + Maintain[i].RoutineServiceFreq + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#txtContractproductType").val("");
            $("#txtContractproductNo").val("");
            $("#txtContractproductItemId").val("");
            $("#ContractproductPage").val("1");
            $(".record_selector_contract_product-modal").modal();

        });

        $("#btnContractproductInfo").click(function () {
            $.ajax({
                url: '@Url.Action("SearchContractProduct", "Main", new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "ContractType": $("#txtContractproductType").val(), "ContractNo": $("#txtContractproductNo").val(), "ItemId": $("#txtContractproductItemId").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divContractproductGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divContractproductGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectContractProductType(this)'>選擇</a>" +
                                "<td class='ContractTypeType'>" + Maintain[i].ContractType + "</td>" +
                                "<td class='OrderSNameType'>" + Maintain[i].OrderSName + "</td>" +
                                "<td class='ContractNoType'>" + Maintain[i].ContractNo + "</td>" +
                                "<td class='ItemIdType'>" + Maintain[i].ItemId + "</td>" +
                                "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                "<td class='SerialNoType'>" + Maintain[i].SerialNo + "</td>" +
                                "<td class='WarrantyPeriodType'>" + Maintain[i].WarrantyPeriod + "</td>" +
                                "<td class='WarrantySDateType'>" + Maintain[i].WarrantySDate + "</td>" +
                                "<td class='WarrantyEDateType'>" + Maintain[i].WarrantyEDate + "</td>" +
                                "<td class='RoutineServiceFreqType'>" + Maintain[i].RoutineServiceFreq + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#ContractproductPage").val("1");
        });

        $("#divContractproductGrid").scroll(function () {
            var Page = document.getElementById("ContractproductPage").value;;
            if (Page != 0) {
                var scrollTop = $(this).scrollTop();
                //var scrollHeight = $(document).height();
                //var windowHeight = $(this).height();
                if (scrollTop + 500 >= (870 - 370) * (Page - 1)) {
                    //此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
                    Page = parseInt(Page) + 1;
                    $.ajax({
                        url: '@Url.Action("SearchContractProduct", "Main", new { Area = "CONI02" })',
                        type: "POST",
                        datatype: 'JSON',
                        data: JSON.stringify({ "ContractType": $("#txtContractproductType").val(), "ContractNo": $("#txtContractproductNo").val(), "ItemId": $("#txtContractproductItemId").val(), Page: Page }),
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            var Maintain = eval(data);
                            for (var i = 0; i < Maintain.length; i++) {
                                $("#divContractproductGrid table tbody").append("<tr>" +
                                   "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectContractProductType(this)'>選擇</a>" +
                                   "<td class='ContractTypeType'>" + Maintain[i].ContractType + "</td>" +
                                   "<td class='OrderSNameType'>" + Maintain[i].OrderSName + "</td>" +
                                   "<td class='ContractNoType'>" + Maintain[i].ContractNo + "</td>" +
                                   "<td class='ItemIdType'>" + Maintain[i].ItemId + "</td>" +
                                   "<td class='CustomerIdType'>" + Maintain[i].CustomerId + "</td>" +
                                   "<td class='CustomerNameType'>" + Maintain[i].CustomerName + "</td>" +
                                   "<td class='CustomerTypeType'>" + Maintain[i].CustomerType + "</td>" +
                                   "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                   "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                   "<td class='SerialNoType'>" + Maintain[i].SerialNo + "</td>" +
                                   "<td class='WarrantyPeriodType'>" + Maintain[i].WarrantyPeriod + "</td>" +
                                   "<td class='WarrantySDateType'>" + Maintain[i].WarrantySDate + "</td>" +
                                   "<td class='WarrantyEDateType'>" + Maintain[i].WarrantyEDate + "</td>" +
                                   "<td class='RoutineServiceFreqType'>" + Maintain[i].RoutineServiceFreq + "</td>" +
                                   "</tr>");
                            }
                        }
                    });
                    $("#ContractproductPage").val(Page);
                }
            }
        });

        $('#id_SerialNo').blur(function () {
            if (document.getElementById("id_SerialNo").readOnly == true) {
                return;
            }
            if ($("#id_SerialNo").val().trim() != "") {
                $.ajax({
                    url: '@Url.Action("SearchWarrantyDInfo", "Main", new { Area = "SERI06" })',
                    data: JSON.stringify({ "ProductNo": $("#id_ProductNo").val().trim(), "SerialNo": $("#id_SerialNo").val().trim(), "ChangeDate": $("#id_OrderDate").val().trim(), "TargetId": $("#id_CustomerId").val(), "WarrantyType": "23" }),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        if (data != "")
                        {
                            $("#id_ProductNo").val(data.ProductNo);        //品號
                            $("#id_ProductName").val(data.ProductName);        //品號
                            $("#id_SaleDate").val(data.ChangeDate);        //品號
                            $("#id_WarrantyPeriod").val(data.WarrantyPeriod);        //品號
                            //$("#SerialNo").val(data.SerialNo);        //品號
                            //$("#VendorWarrantyStartDate").val("");        //品號
                            //$("#VendorWarrantyExpiryDate").val("");        //品號
                            $("#id_WarrantySDate").val(data.WarrantySDate);        //品號
                            $("#id_WarrantyEDate").val(data.WarrantyEDate);        //品號
                            //if (data.WarrantySDate < $("#id_OrderDate").val()
                            //    && $("#id_OrderDate").val() < data.WarrantyEDate)        //續約
                            //{
                            //    document.getElementById('UnderWarranty').checked = true;
                            //} else {
                            //    document.getElementById('UnderWarranty').checked = false;
                            //}
                            $("#id_CustomerId").val(data.TargetId);        //客戶代號
                            $("#customername").html(data.TargetName);     //客戶名稱
                            $.ajax({
                                url: '@Url.Action("SearchCustomerInfo", "Main", new { Area = "CONI02" })',
                                data: JSON.stringify({ "CustomerId": $("#id_CustomerId").val().trim() }),
                                type: 'POST',
                                contentType: 'application/json; charset=utf-8',
                                success: function (data) {
                                    $('#id_CustomerType').val(data.CustomerType);
                                }, error: function () {
                                    $('#id_CustomerType').val("");
                                }
                            })
                            @*$.ajax({
                                url: '@Url.Action("SearchWarrantyDInfo", "Main", new { Area = "SERI06" })',
                                data: JSON.stringify({ "ProductNo": $("#id_ProductNo").val(), "SerialNo": $("#id_SerialNo").val(), "ChangeDate": "", "WarrantyType": "01" }),
                                type: 'POST',
                                contentType: 'application/json; charset=utf-8',
                                success: function (data) {
                                    $("#VendorWarrantyStartDate").val(data.WarrantySDate);     //品名
                                    $("#VendorWarrantyExpiryDate").val(data.WarrantyEDate);     //品名
                                }
                            })*@
                        }else
                        {
                            $("#msg_information").html("序號不存在！");
                            $('.msg-modal-lg').modal();
                            $("#id_ProductNo").val("");        //品號
                            $("#id_ProductName").val("");        //品號
                            $("#id_SerialNo").val("");        //品號
                            $("#id_WarrantySDate").val("");        //品號
                            $("#id_WarrantyEDate").val("");        //品號
                            //$("#VendorWarrantyStartDate").val("");        //品號
                            //$("#VendorWarrantyExpiryDate").val("");        //品號
                            //document.getElementById('UnderWarranty').checked = false;
                            $("#id_CustomerId").val("");        //客戶代號
                            $("#customername").html("");     //客戶名稱
                            $("#id_SaleDate").val("");        //品號
                            $("#id_WarrantyPeriod").val("");        //品號
                            return;
                        }


                    },
                    error: function () {
                        $("#msg_information").html("序號不存在！");
                        $('.msg-modal-lg').modal();
                        $("#id_ProductNo").val("");        //品號
                        $("#id_ProductName").val("");        //品號
                        $("#id_SerialNo").val("");        //品號
                        $("#id_WarrantySDate").val("");        //品號
                        $("#id_WarrantyEDate").val("");        //品號
                        //$("#VendorWarrantyStartDate").val("");        //品號
                        //$("#VendorWarrantyExpiryDate").val("");        //品號
                        //document.getElementById('UnderWarranty').checked = false;
                        $("#id_CustomerId").val("");        //客戶代號
                        $("#customername").html("");     //客戶名稱
                        $("#id_SaleDate").val("");        //品號
                        $("#id_WarrantyPeriod").val("");        //品號
                        return;
                    }
                })
            }
            //else {
            //    $("#id_ProductNo").val("");        //品號
            //    $("#id_ProductName").val("");        //品號
            //    $("#id_SerialNo").val("");        //品號
            //    $("#id_WarrantySDate").val("");        //品號
            //    $("#id_WarrantyEDate").val("");        //品號
            //    //$("#VendorWarrantyStartDate").val("");        //品號
            //    //$("#VendorWarrantyExpiryDate").val("");        //品號
            //    $("#id_CustomerId").val("");        //客戶代號
            //    $("#customername").html("");     //客戶名稱
            //    $("#id_SaleDate").val("");        //品號
            //    $("#id_WarrantyPeriod").val("");        //品號
            //}
        });

        $("#btnSerialNo").click(function () {
            $.ajax({
                url: '@Url.Action("SearchWarrantySerialNo", "Main",new { Area = "SERI06" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "Col": ",d.ProductNo,WarrantySDate,WarrantyEDate,TargetId,SerialNo", "Condition": ",=,<,>,=,%like%", "conditionValue": "," + $("#id_ProductNo").val() + "," + $("#id_OrderDate").val().replace(/\//g, "") + "," + $("#id_OrderDate").val().replace(/\//g, "") + "," + $("#id_CustomerId").val() + "," + $("#id_SerialNo").val(), Page: 1 }),
                //data: JSON.stringify({ "ProductNo": $("#ProductNo").val(), "SerialNo": "", "ChangeDate": $("#id_OrderDate").val(), "WarrantyType": "23", "TargetId": $("#id_CustomerId").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divWarrantySerialNoGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                            $("#divWarrantySerialNoGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectSerialNo(this)'>選擇</a>" +
                                "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                "<td class='SerialNoType'>" + Maintain[i].SerialNo + "</td>" +
                                "<td class='ChangeDateType'>" + Maintain[i].ChangeDate + "</td>" +
                                "<td class='TargetIdType'>" + Maintain[i].TargetId + "</td>" +
                                "<td class='TargetNameType'>" + Maintain[i].TargetName + "</td>" +
                                "<td class='WarrantyPeriodType'>" + Maintain[i].WarrantyPeriod + "</td>" +
                                "<td class='WarrantySDateType'>" + Maintain[i].WarrantySDate + "</td>" +
                                "<td class='WarrantyEDateType'>" + Maintain[i].WarrantyEDate + "</td>" +
                                "<td class='WarrantyTypeType'>" + Maintain[i].WarrantyType + "</td>" +
                                "</tr>");

                    }
                }
            });
            $("#txtWarrantyProductNo").val($("#ProductNo").val());
            $("#txtWarrantySerialNo").val("");
            $("#txtWarrantyTargetId").val($("#id_CustomerId").val());
            $("#WarrantySerialNoPage").val("1");
            $(".record-selector-WarrantySerialNo-modal").modal();
        });

        $("#btnWarrantySerialNo").click(function () {
            $.ajax({
                url: '@Url.Action("SearchWarrantySerialNo", "Main", new { Area = "SERI06" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "Col": ",d.ProductNo,WarrantySDate,WarrantyEDate,TargetId," + $("#addWarrantySerialNoCol").val(), "Condition": ",=,<,>,=," + $("#addWarrantySerialNoCondition").val(), "conditionValue": "," + $("#id_ProductNo").val() + "," + $("#id_OrderDate").val().replace(/\//g, "") + "," + $("#id_OrderDate").val().replace(/\//g, "") + "," + $("#id_CustomerId").val() + "," + $("#addWarrantySerialNoconditionValue").val(), Page: 1 }),
                //data: JSON.stringify({ "ProductNo": $("#txtWarrantyProductNo").val(), "SerialNo": $("#txtWarrantySerialNo").val(), "ChangeDate": $("#id_OrderDate").val(), "WarrantyType": "23", "TargetId": $("#txtWarrantyTargetId").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divWarrantySerialNoGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divWarrantySerialNoGrid table tbody").append("<tr>" +
                            "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectSerialNo(this)'>選擇</a>" +
                                "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                "<td class='SerialNoType'>" + Maintain[i].SerialNo + "</td>" +
                                "<td class='ChangeDateType'>" + Maintain[i].ChangeDate + "</td>" +
                                "<td class='TargetIdType'>" + Maintain[i].TargetId + "</td>" +
                                "<td class='TargetNameType'>" + Maintain[i].TargetName + "</td>" +
                                "<td class='WarrantyPeriodType'>" + Maintain[i].WarrantyPeriod + "</td>" +
                                "<td class='WarrantySDateType'>" + Maintain[i].WarrantySDate + "</td>" +
                                "<td class='WarrantyEDateType'>" + Maintain[i].WarrantyEDate + "</td>" +
                                "<td class='WarrantyTypeType'>" + Maintain[i].WarrantyType + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#WarrantySerialNoPage").val("1");
        });

        $("#divWarrantySerialNoGrid").scroll(function () {
            var Page = document.getElementById("WarrantySerialNoPage").value;;
            if (Page != 0) {
                var scrollTop = $(this).scrollTop();
                //var scrollHeight = $(document).height();
                //var windowHeight = $(this).height();
                if (scrollTop + 500 >= (870 - 370) * (Page - 1)) {
                    //此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
                    Page = parseInt(Page) + 1;
                    $.ajax({
                        url: '@Url.Action("SearchWarrantySerialNo", "Main", new { Area = "SERI06" })',
                        type: "POST",
                        datatype: 'JSON',
                        data: JSON.stringify({ "Col": ",d.ProductNo,WarrantySDate,WarrantyEDate,TargetId," + $("#addWarrantySerialNoCol").val(), "Condition": ",=,<,>,=," + $("#addWarrantySerialNoCondition").val(), "conditionValue": "," + $("#id_ProductNo").val() + "," + $("#id_OrderDate").val().replace(/\//g, "") + "," + $("#id_OrderDate").val().replace(/\//g, "") + "," + $("#id_CustomerId").val() + "," + $("#addWarrantySerialNoconditionValue").val(), Page: Page }),
                        //data: JSON.stringify({ "ProductNo": $("#txtWarrantyProductNo").val(), "SerialNo": $("#txtWarrantySerialNo").val(), "ChangeDate": $("#id_OrderDate").val(), "WarrantyType": "23", "TargetId": $("#txtWarrantyTargetId").val(), Page: Page }),
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            var Maintain = eval(data);
                            for (var i = 0; i < Maintain.length; i++) {
                                $("#divWarrantySerialNoGrid table tbody").append("<tr>" +
                                    "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectSerialNo(this)'>選擇</a>" +
                                "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                "<td class='SerialNoType'>" + Maintain[i].SerialNo + "</td>" +
                                "<td class='ChangeDateType'>" + Maintain[i].ChangeDate + "</td>" +
                                "<td class='TargetIdType'>" + Maintain[i].TargetId + "</td>" +
                                "<td class='TargetNameType'>" + Maintain[i].TargetName + "</td>" +
                                "<td class='WarrantyPeriodType'>" + Maintain[i].WarrantyPeriod + "</td>" +
                                "<td class='WarrantySDateType'>" + Maintain[i].WarrantySDate + "</td>" +
                                "<td class='WarrantyEDateType'>" + Maintain[i].WarrantyEDate + "</td>" +
                                "<td class='WarrantyTypeType'>" + Maintain[i].WarrantyType + "</td>" +
                                "</tr>");
                            }
                        }
                    });
                    $("#WarrantySerialNoPage").val(Page);
                }
            }
        });

        $('#id_ProductNo').blur(function () {
            if (document.getElementById("id_ProductNo").readOnly == true) {
                return;
            }
            if ($("#id_ProductNo").val().trim() != "") {
                $.ajax({
                    url: '@Url.Action("SearchProductInfo", "Main")',
                    data: JSON.stringify({ "ProductNo": $("#id_ProductNo").val().trim() }),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $("#id_ProductNo").val(data.ProductNo);        //品號
                        $("#id_ProductName").val(data.ProductName);     //品名
                    },
                    error: function () {
                        $("#msg_information").html("品號不存在！");
                        $('.msg-modal-lg').modal();
                        $("#id_ProductNo").val("");        //品號
                        $("#id_ProductName").val("");     //品名
                    }
                })
            } else {
                $("#id_ProductNo").val("");        //品號
                $("#id_ProductName").val("");     //品名
            }
        });

        $("#btnProductNo").click(function () {
            $.ajax({
                url: '@Url.Action("SearchProduct", "Main", new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({  "Col": ",ProductNo", "Condition": ",=", "conditionValue": "," + $("#id_ProductNo").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divProductGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divProductGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectProduct(this)'>選擇</a>" +
                                "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                "<td class='SpecificationType'>" + Maintain[i].Specification + "</td>" +
                                "<td class='UnitType'>" + Maintain[i].Unit + "</td>" +
                                "<td class='ProductTypeId1NameType'>" + Maintain[i].ProductTypeId1Name + "</td>" +
                                "<td class='VendorNameType'>" + Maintain[i].VendorName + "</td>" +
                                "</tr>");

                    }
                }
            });
            $("#txtProductNo").val("");
            $("#txtProductName").val("");
            $("#ProductPage").val("1");
            $(".record-selector-product-modal").modal();
        });

        $("#btnSearchProduct").click(function () {
            $.ajax({
                url: '@Url.Action("SearchProduct", "Main",new { Area = "CONI02" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({  "Col": "," + $("#addProduct_Col").val(), "Condition": "," + $("#addProduct_Condition").val(), "conditionValue": "," + $("#addProduct_conditionValue").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divProductGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divProductGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectProduct(this)'>選擇</a>" +
                                "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                "<td class='SpecificationType'>" + Maintain[i].Specification + "</td>" +
                                "<td class='UnitType'>" + Maintain[i].Unit + "</td>" +
                                "<td class='ProductTypeId1NameType'>" + Maintain[i].ProductTypeId1Name + "</td>" +
                                "<td class='VendorNameType'>" + Maintain[i].VendorName + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#ProductPage").val("1");
        });

        $("#divProductGrid").scroll(function () {
            var Page = document.getElementById("ProductPage").value;;
            if (Page != 0) {
                var scrollTop = $(this).scrollTop();
                //var scrollHeight = $(document).height();
                //var windowHeight = $(this).height();
                if (scrollTop + 500 >= (870 - 370) * (Page - 1)) {
                    //此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
                    Page = parseInt(Page) + 1;
                    $.ajax({
                        url: '@Url.Action("SearchProduct", "Main", new { Area = "CONI02" })',
                        type: "POST",
                        datatype: 'JSON',
                        data: JSON.stringify({"Col": "," + $("#addProduct_Col").val(), "Condition": "," + $("#addProduct_Condition").val(), "conditionValue": "," + $("#addProduct_conditionValue").val(), Page: Page }),
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            var Maintain = eval(data);
                            for (var i = 0; i < Maintain.length; i++) {
                                $("#divProductGrid table tbody").append("<tr>" +
                                    "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectProduct(this)'>選擇</a>" +
                                    "<td class='ProductNoType'>" + Maintain[i].ProductNo + "</td>" +
                                    "<td class='ProductNameType'>" + Maintain[i].ProductName + "</td>" +
                                    "<td class='SpecificationType'>" + Maintain[i].Specification + "</td>" +
                                    "<td class='UnitType'>" + Maintain[i].Unit + "</td>" +
                                    "<td class='ProductTypeId1NameType'>" + Maintain[i].ProductTypeId1Name + "</td>" +
                                    "<td class='VendorNameType'>" + Maintain[i].VendorName + "</td>" +
                                    "</tr>");
                            }
                        }
                    });
                    $("#ProductPage").val(Page);
                }
            }

        });

        $('#id_ProductNo').blur(function () {
            if (document.getElementById("id_ProductNo").readOnly == true) {
                return;
            }
            if ($("#id_ProductNo").val().trim() != "") {
                $.ajax({
                    url: '@Url.Action("SearchProductInfo", "Main")',
                    data: JSON.stringify({ "ProductNo": $("#id_ProductNo").val().trim() }),
                    type: 'POST',
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        $("#id_ProductNo").val(data.ProductNo);        //品號
                        $("#id_ProductName").val(data.ProductName);     //品名
                    },
                    error: function () {
                        $("#msg_information").html("品號不存在！");
                        $('.msg-modal-lg').modal();
                        $("#id_ProductNo").val("");        //品號
                        $("#id_ProductName").val("");     //品名
                    }
                })
            } else {
                $("#id_ProductNo").val("");        //品號
                $("#id_ProductName").val("");     //品名
            }
        });

        $("#btnServiceArrange_D").click(function () {

            if (document.getElementById("id_CustomerId").value == "") {
                $("#msg_information").html("客戶代號不能為空！");
                $('.msg-modal-lg').modal();
                return;
            }

            if (document.getElementById("id_RoutineServiceFreq").value == "") {
                $("#msg_information").html("定期保養不能為空！");
                $('.msg-modal-lg').modal();
                return;
            }

            if (document.getElementById("id_WarrantyPeriod").value == "") {
                $("#msg_information").html("保固期限不能為空！");
                $('.msg-modal-lg').modal();
                return;
            }

            if (document.getElementById("id_WarrantySDate").value == "") {
                $("#msg_information").html("保固起日不能為空！");
                $('.msg-modal-lg').modal();
                return;
            }

            if (document.getElementById("id_WarrantyEDate").value == "") {
                $("#msg_information").html("保固迄日不能為空！");
                $('.msg-modal-lg').modal();
                return;
            }

            var SDate = new Date(document.getElementById("id_WarrantySDate").value);
            var EDate = new Date(document.getElementById("id_WarrantyEDate").value);
            if (EDate < SDate)
            {
                $("#msg_information").html("保固迄日小於保固起日！");
                $('.msg-modal-lg').modal();
                return;
            }

            var AddressSName = "";
            var Address = "";

            //查找客戶基本信息
            $.ajax({
                url: '@Url.Action("SearchCustomerInfo", "Main", new { Area = "CMSI09" })',
                data: JSON.stringify({ "CustomerId": $("#id_CustomerId").val().trim() }),
                type: 'POST',
                async: false,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    AddressSName=data.AddressSName;     //地址簡稱
                    Address=data.Address;    //地址
                }
            })

            var data = parseInt((EDate.getTime() - SDate.getTime()) / 86400000);

            var avgData = parseInt(data) / parseInt($("#id_RoutineServiceFreq").val());

            //var Amonth = new Date(document.getElementById("id_WarrantySDate").value);
            var Amonth = document.getElementById("id_WarrantySDate").value;
            for (var i = 0; i < parseInt($("#id_RoutineServiceFreq").val()) ; i++) {
                //Amonth.setMonth(Amonth.getMonth() + parseInt(avgMonth));
                //var year = Amonth.getFullYear();//当前年份
                //var month = Amonth.getMonth() + 1;//当前月份
                //if (month.toString().length == 1) {
                //    month = "0" + month;
                //}
                var arrMonth = EDateAddDay(Amonth, avgData);
                if (EDate < new Date(arrMonth))
                {
                    arrMonth = document.getElementById("id_WarrantyEDate").value;
                }
                //var arrMonth = year.toString() + month.toString();
                $("#divServiceArrange_DGrid table tbody").append("<tr>" +
                    "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='ProductDExit(this)'>編輯</a><a class='btn btn-link' data-dismiss='modal' onclick='RemoveProcess(this)'>刪除</a>" +
                    "<td class='ItemId'>" + addZero((parseInt(i) + 1).toString(), 4) + "<input type='hidden' class='strCItemId' name='strCItemId' value='" + addZero((parseInt(i) + 1).toString(), 4) + "'></td>" +
                    "<td class='ArrangeMonth'>" + arrMonth + "<input type='hidden' class='strCArrangeMonth' name='strCArrangeMonth' value='" + arrMonth + "'></td>" +
                    "<td class='AddressSName'>" + AddressSName + "<input type='hidden' class='strCAddressSName' name='strCAddressSName' value='" + AddressSName + "'></td>" +
                    "<td class='Address'>" + Address + "<input type='hidden' class='strCAddress' name='strCAddress' value='" + Address + "'></td>" +
                    "<td class='IsClosed'> N.未結案<input type='hidden' class='strCIsClosed' name='strCIsClosed' value='N.未結案'></td>" +
                    "<td class='DRemark'>" + $("#id_Remark").val() + "<input type='hidden' class='strCRemark' name='strCRemark' value='" + $("#id_Remark").val() + "'></td>" +
                    "</tr>");
                Amonth = arrMonth;
            }

            $('#btnServiceArrange_D').attr('disabled', true);
            $('#btnCleanServiceArrange_D').removeAttr("disabled");
        });

        $("#btnCleanServiceArrange_D").click(function () {
            $("#divServiceArrange_DGrid table tbody").empty();
            $('#btnCleanServiceArrange_D').attr('disabled', true);
            $('#btnServiceArrange_D').removeAttr("disabled");
        });

        $("#btnChooseTargetId").click(function () {
            $('.choose-modal').modal();
        });

        $("#btnAddress").click(function () {
            if ($("#id_CustomerId").val().trim() == "") {
                alert("請先選擇客戶");
                return;
            }
            $.ajax({
                url: '@Url.Action("SearchCustomerAddress", "Main", new { Area = "SUPI05" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "CustomerId": $("#id_CustomerId").val().trim(), "Col": "", "Condition": "", "conditionValue": "", Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divCustomerAddressGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divCustomerAddressGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectAddress(this)'>選擇</a>" +
                                "<td class='AddressIdType'>" + Maintain[i].AddressId + "</td>" +
                                "<td class='Address1Type'>" + Maintain[i].AddressSName + "</td>" +
                                "<td class='Address2Type'>" + Maintain[i].Address + "</td>" +
                                "<td class='ContactType'>" + Maintain[i].Contact + "</td>" +
                                "<td class='TelNoType'>" + Maintain[i].TelNo + "</td>" +
                                "<td class='FaxNoType'>" + Maintain[i].FaxNo + "</td>" +
                                "<td class='RemarkType'>" + Maintain[i].Remark + "</td>" +
                                "</tr>");

                    }
                }
            });
            $("#txtAddressId").val("");
            $("#txtAddress1").val("");
            $("#CustomerAddressPage").val("1");
            $(".record-selector-customeraddress-modal").modal();
        });

        $("#btnAddressInfo").click(function () {
            $.ajax({
                url: '@Url.Action("SearchCustomerAddress", "Main", new { Area = "SUPI05" })',
                type: "POST",
                datatype: 'JSON',
                data: JSON.stringify({ "CustomerId": $("#id_CustomerId").val(), "Col": $("#addAddress_Col").val(), "Condition": $("#addAddress_Condition").val(), "conditionValue": $("#addAddress_conditionValue").val(), Page: 1 }),
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    $("#divCustomerAddressGrid table tbody").empty();
                    var Maintain = eval(data);
                    for (var i = 0; i < Maintain.length; i++) {
                        $("#divCustomerAddressGrid table tbody").append("<tr>" +
                                "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectAddress(this)'>選擇</a>" +
                                "<td class='AddressIdType'>" + Maintain[i].AddressId + "</td>" +
                                "<td class='Address1Type'>" + Maintain[i].AddressSName + "</td>" +
                                "<td class='Address2Type'>" + Maintain[i].Address + "</td>" +
                                "<td class='ContactType'>" + Maintain[i].Contact + "</td>" +
                                "<td class='TelNoType'>" + Maintain[i].TelNo + "</td>" +
                                "<td class='FaxNoType'>" + Maintain[i].FaxNo + "</td>" +
                                "<td class='RemarkType'>" + Maintain[i].Remark + "</td>" +
                                "</tr>");
                    }
                }
            });
            $("#CustomerAddressPage").val("1");
        });

        $("#divCustomerAddressGrid").scroll(function () {
            var Page = document.getElementById("CustomerAddressPage").value;;
            if (Page != 0) {
                var scrollTop = $(this).scrollTop();
                //var scrollHeight = $(document).height();
                //var windowHeight = $(this).height();
                if (scrollTop + 500 >= (870 - 370) * (Page - 1)) {
                    //此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
                    Page = parseInt(Page) + 1;
                    $.ajax({
                        url: '@Url.Action("SearchCustomerAddress", "Main", new { Area = "SUPI05" })',
                        type: "POST",
                        datatype: 'JSON',
                        data: JSON.stringify({ "CustomerId": $("#id_CustomerId").val(), "Col": $("#addAddress_Col").val(), "Condition": $("#addAddress_Condition").val(), "conditionValue": $("#addAddress_conditionValue").val(), Page: Page }),
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            var Maintain = eval(data);
                            for (var i = 0; i < Maintain.length; i++) {
                                $("#divCustomerAddressGrid table tbody").append("<tr>" +
                                    "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='SelectAddress(this)'>選擇</a>" +
                                    "<td class='AddressIdType'>" + Maintain[i].AddressId + "</td>" +
                                    "<td class='Address1Type'>" + Maintain[i].AddressSName + "</td>" +
                                    "<td class='Address2Type'>" + Maintain[i].Address + "</td>" +
                                    "<td class='ContactType'>" + Maintain[i].Contact + "</td>" +
                                    "<td class='TelNoType'>" + Maintain[i].TelNo + "</td>" +
                                    "<td class='FaxNoType'>" + Maintain[i].FaxNo + "</td>" +
                                    "<td class='RemarkType'>" + Maintain[i].Remark + "</td>" +
                                    "</tr>");
                            }
                        }
                    });
                    $("#CustomerAddressPage").val(Page);
                }
            }

        });

    });

    function RemoveProcess(id) {
        $(id).parents('tr:first').remove();
        var table = document.getElementById("divServiceArrange_DGrid");
        var trs = table.getElementsByTagName('tr');
        var stritem = "";
        for (var i = 1; i < trs.length; i++) {
            stritem = addZero((i).toString(), 4);
            trs[i].cells[1].innerHTML = stritem + "<input type='hidden' class='strCItemId' name='strCItemId' value='" + stritem + "'>";

        }
    }

    function ProductDExit(id) {
        $("#id_ServiceArrange_DItemId").val($(id).closest('tr').find(".strCItemId").val());        //品號
        $("#id_ServiceArrange_DArrangeMonth").val($(id).closest('tr').find(".strCArrangeMonth").val());        //品號
        $("#id_ServiceArrange_DAddressSName").val($(id).closest('tr').find(".strCAddressSName").val());        //品名
        $("#id_ServiceArrange_DAddress").val($(id).closest('tr').find(".strCAddress").val());        //數量
        var select = document.getElementById("id_ServiceArrange_DIsClosed");
        var next = $(id).closest('tr').find(".strCIsClosed").val();
        for (var i = 0; i < select.options.length; i++) {
            if (select.options[i].innerHTML == next) {
                select.options[i].selected = true;
                break;
            }
        }
        $("#id_ServiceArrange_DRemark").val($(id).closest('tr').find(".strCRemark").val());        //保固期限
        $('.ServiceArrange_D-modal').modal();
    };

    function checkProductD() {
        var table = document.getElementById("divServiceArrange_DGrid");
        var trs = table.getElementsByTagName('tr');
        for (var i = 0; i < trs.length; i++) {
            if ($(trs[i]).closest('tr').find(".strCItemId").val() == $("#id_ServiceArrange_DItemId").val()) {
                trs[i].innerHTML = "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='ProductDExit(this)'>編輯</a><a class='btn btn-link' data-dismiss='modal' onclick='RemoveProcess(this)'>刪除</a>" +
                    "<td class='ItemId'>" + $("#id_ServiceArrange_DItemId").val() + "<input type='hidden' class='strCItemId' name='strCItemId' value='" + $("#id_ServiceArrange_DItemId").val() + "'></td>" +
                    "<td class='ArrangeMonth'>" + $("#id_ServiceArrange_DArrangeMonth").val() + "<input type='hidden'class='strCArrangeMonth' name='strCArrangeMonth'  value='" + $("#id_ServiceArrange_DArrangeMonth").val() + "'></td>" +
                    "<td class='AddressSName'>" + $("#id_ServiceArrange_DAddressSName").val() + "<input type='hidden' class='strCAddressSName' name='strCAddressSName' value='" + $("#id_ServiceArrange_DAddressSName").val() + "'></td>" +
                    "<td class='Address'>" + $("#id_ServiceArrange_DAddress").val() + "<input type='hidden' class='strCAddress' name='strCAddress' value='" + $("#id_ServiceArrange_DAddress").val() + "'></td>" +
                    "<td class='IsClosed'>" + $("#id_ServiceArrange_DIsClosed").val() + "<input type='hidden' class='strCIsClosed' name='strCIsClosed' value='" + $("#id_ServiceArrange_DIsClosed").val() + "'></td>" +
                    "<td class='DRemark'>" + $("#id_ServiceArrange_DRemark").val() + "<input type='hidden'class='strCRemark' name='strCRemark' value='" + $("#id_ServiceArrange_DRemark").val() + "'></td>";
                $(".ServiceArrange_D-modal").modal("hide");
                return;
            }

        }

        $("#divSupportApl_ProductDGrid table tbody").append("<tr>" +
             "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='ProductDExit(this)'>編輯</a><a class='btn btn-link' data-dismiss='modal' onclick='RemoveProcess(this)'>刪除</a>" +
                    "<td class='ItemId'>" + $("#id_ServiceArrange_DItemId").val() + "<input type='hidden' class='strCItemId' name='strCItemId' value='" + $("#id_ServiceArrange_DItemId").val() + "'></td>" +
                    "<td class='ArrangeMonth'>" + $("#id_ServiceArrange_DArrangeMonth").val() + "<input type='hidden'class='strCArrangeMonth' name='strCArrangeMonth'  value='" + $("#id_ServiceArrange_DArrangeMonth").val() + "'></td>" +
                    "<td class='AddressSName'>" + $("#id_ServiceArrange_DAddressSName").val() + "<input type='hidden' class='strCAddressSName' name='strCAddressSName' value='" + $("#id_ServiceArrange_DAddressSName").val() + "'></td>" +
                    "<td class='Address'>" + $("#id_ServiceArrange_DAddress").val() + "<input type='hidden' class='strCAddress' name='strCAddress' value='" + $("#id_ServiceArrange_DAddress").val() + "'></td>" +
                    "<td class='IsClosed'>" + $("#id_ServiceArrange_DIsClosed").val() + "<input type='hidden' class='strCIsClosed' name='strCIsClosed' value='" + $("#id_ServiceArrange_DIsClosed").val() + "'></td>" +
                    "<td class='DRemark'>" + $("#id_ServiceArrange_DRemark").val() + "<input type='hidden'class='strCRemark' name='strCRemark' value='" + $("#id_ServiceArrange_DRemark").val() + "'></td>" +
            "</tr>");

        $(".ServiceArrange_D-modal").modal("hide");

    };

    function SelectContractProductType(id) {
        $("#id_CustomerId").val($(id).closest('tr').find(".CustomerIdType").html());        //客戶代號
        $("#customername").html($(id).closest('tr').find(".CustomerNameType").html());     //客戶名稱
        $("#id_CustomerType").val($(id).closest('tr').find(".CustomerTypeType").html());     //客戶形態
        $("#id_SourceOrderType").val($(id).closest('tr').find(".ContractTypeType").html());      //來源單別
        $("#id_SourceOrderNo").val($(id).closest('tr').find(".ContractNoType").html());    //來源單號
        $("#id_SourceOrderItemId").val($(id).closest('tr').find(".ItemIdType").html());    //來源項次
        $("#id_SerialNo").val($(id).closest('tr').find(".SerialNoType").html());      //序號
        $("#id_ProductNo").val($(id).closest('tr').find(".ProductNoType").html());    //品號
        $("#id_ProductName").val($(id).closest('tr').find(".ProductNameType").html());    //品名
        $("#id_RoutineServiceFreq").val($(id).closest('tr').find(".RoutineServiceFreqType").html());    //定期保養
        $("#id_WarrantyPeriod").val($(id).closest('tr').find(".WarrantyPeriodType").html());    //保固期限
        $("#id_WarrantySDate").val($(id).closest('tr').find(".WarrantySDateType").html());    //保固起日
        $("#id_WarrantyEDate").val($(id).closest('tr').find(".WarrantyEDateType").html());    //保固迄日
    }

    function SelectAddress(id) {
        $("#id_ServiceArrange_DAddressSName").val($(id).closest('tr').find(".Address1Type").html());
        $("#id_ServiceArrange_DAddress").val($(id).closest('tr').find(".Address2Type").html());
    }

    function SelectProduct(id) {
        $("#id_ProductNo").val($(id).closest('tr').find(".ProductNoType").html());        //品號
        $("#id_ProductName").val($(id).closest('tr').find(".ProductNameType").html());     //品名
    }

    function btnAdd() {
        if (document.getElementById("id_ProductNo").value == "") {
            $("#msg_information").html("品號不能為空！");
            $('.msg-modal-lg').modal();
            return;
        }

        if (document.getElementById("id_SerialNo").value == "") {
            $("#msg_information").html("序號不能為空！");
            $('.msg-modal-lg').modal();
            return;
        }

        if (document.getElementById("CheckExOrder").value == "Y") {
            if (document.getElementById("id_SourceOrderType").value == "") {
                $("#msg_information").html("來源單號不能為空！");
                $('.msg-modal-lg').modal();
                return;
            }
        }

        @*var ajaxType = true;

        $.ajax({
            url: '@Url.Action("SerialNo", "Main")',
            data: JSON.stringify({ "SerialNo": document.getElementById("id_SerialNo").value }),
            type: 'POST',
            async: false,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data == false) {
                    $("#msg_information").html("輸入的商品序號已存在，請重新輸入！");
                    $('.msg-modal-lg').modal();
                    ajaxType = false;
                    return;
                }
            }
        })*@

        $.ajax({
            url: '@Url.Action("Add", "Main")',
            data: $('#from-ServiceArrange').serialize(),
            type: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            success: function (data) {
                var strData = data.split('-');
                if (strData[0] == "NO") {
                    $("#msg_information").html(strData[1]);
                    $('.msg-modal-lg').modal();
                } else {
                    window.location.href = '@Url.Action("Index", "Main")';
                }

            }
        })
    };

    function btnAddAgain() {
        if (document.getElementById("id_ProductNo").value == "") {
            $("#msg_information").html("品號不能為空！");
            $('.msg-modal-lg').modal();
            return;
        }

        if (document.getElementById("id_SerialNo").value == "") {
            $("#msg_information").html("序號不能為空！");
            $('.msg-modal-lg').modal();
            return;
        }

        if (document.getElementById("CheckExOrder").value == "Y") {
            if (document.getElementById("id_SourceOrderType").value == "") {
                $("#msg_information").html("來源單號不能為空！");
                $('.msg-modal-lg').modal();
                return;
            }
        }

        @*var ajaxType = true;

        $.ajax({
            url: '@Url.Action("SerialNo", "Main")',
            data: JSON.stringify({ "SerialNo": document.getElementById("id_SerialNo").value }),
            type: 'POST',
            async: false,
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data == false) {
                    $("#msg_information").html("輸入的商品序號已存在，請重新輸入！");
                    $('.msg-modal-lg').modal();
                    ajaxType = false;
                    return;
                }
            }
        })*@

        $.ajax({
            url: '@Url.Action("Add", "Main")',
            data: $('#from-ServiceArrange').serialize(),
            type: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            success: function (data) {
                var strData = data.split('-');
                if (strData[0] == "NO") {
                    $("#msg_information").html(strData[1]);
                    $('.msg-modal-lg').modal();
                } else {
                    window.location.href = '@Url.Action("CUR", "Main")';
                }

            }
        })
    };

    function btnExit() {
        $.ajax({
            url: '@Url.Action("Exit", "Main")',
            data: $('#from-ServiceArrange').serialize(),
            type: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            success: function (data) {
                var strData = data.split('-');
                if (strData[0] == "NO") {
                    $("#msg_information").html(strData[1]);
                    $('.msg-modal-lg').modal();
                } else {
                    window.location.href = '@Url.Action("Index", "Main")';
                }

            }
        })
    };

    function btnExitAgain() {
        $.ajax({
            url: '@Url.Action("Exit", "Main")',
            data: $('#from-ServiceArrange').serialize(),
            type: 'POST',
            contentType: 'application/x-www-form-urlencoded',
            success: function (data) {
                var strData = data.split('-');
                if (strData[0] == "NO") {
                    $("#msg_information").html(strData[1]);
                    $('.msg-modal-lg').modal();
                } else {
                    window.location.href = '@Url.Action("CUR", "Main")';
                }

            }
        })
    };

    function check() {
        if ($("#id_Warranty_DChangeDate").val() == '') {
            $("#msg_information").html("異動日期不能為空！");
            $('.msg-modal-lg').modal();
            return;
        }

        if ($("#id_Warranty_DTargetId").val() == '') {
            $("#msg_information").html("異動對象不能為空！");
            $('.msg-modal-lg').modal();
            return;
        }

        if ($("#id_Warranty_DWarrantyPeriod").val() == '') {
            $("#msg_information").html("保固期限不能為空！");
            $('.msg-modal-lg').modal();
            return;
        }
        if (parseInt($("#id_Warranty_DWarrantyPeriod").val()) == 0) {
            $("#msg_information").html("保固期限須大於0！");
            $('.msg-modal-lg').modal();
            return;
        }
        if ($("#id_Warranty_DWarrantySDate").val() == '') {
            $("#msg_information").html("请输入保固起日！");
            $('.msg-modal-lg').modal();
            return;
        }

        if ($("#id_Warranty_DWarrantyEDate").val() == '') {
            $("#msg_information").html("请输入保固迄日！");
            $('.msg-modal-lg').modal();
            return;
        }

        $("#divServiceArrange_DGrid table tbody").append("<tr>" +
            "<td class='actioncolumn'><a class='btn btn-link' data-dismiss='modal' onclick='ProductDExit(this)'>編輯</a>|<a class='btn btn-link' data-dismiss='modal' onclick='RemoveProcess(this)'>刪除</a>" +
            "<td class='ChangeDate'>" + $("#id_Warranty_DChangeDate").val() + "<input type='hidden' class='strCChangeDate' name='strCChangeDate' value='" + $("#id_Warranty_DChangeDate").val() + "'></td>" +
            "<td class='ChangeOrderType'>" + $("#id_Warranty_DChangeOrderType").val() + "<input type='hidden' class='strCChangeOrderType' name='strCChangeOrderType' value='" + $("#id_Warranty_DChangeOrderType").val() + "'></td>" +
            "<td class='ChangeOrderNo'>" + $("#id_Warranty_DChangeOrderNo").val() + "<input type='hidden' class='strCChangeOrderNo' name='strCChangeOrderNo' value='" + $("#id_Warranty_DChangeOrderNo").val() + "'></td>" +
            "<td class='ChangeOrderItemId'>" + $("#id_Warranty_DChangeOrderItemId").val() + "<input type='hidden' class='strCChangeOrderItemId' name='strCChangeOrderItemId' value='" + $("#id_Warranty_DChangeOrderItemId").val() + "'></td>" +
            "<td class='TargetId'>" + $("#id_Warranty_DTargetId").val() + "<input type='hidden' class='strCTargetId' name='strCTargetId' value='" + $("#id_Warranty_DTargetId").val() + "'></td>" +
            "<td class='TargetName'>" + $("#id_Warranty_DTargetName").val() + "<input type='hidden' class='strCTargetName' name='strCTargetName' value='" + $("#id_Warranty_DTargetName").val() + "'></td>" +
            "<td class='WarrantyPeriod'>" + $("#id_Warranty_DWarrantyPeriod").val() + "<input type='hidden' class='strCWarrantyPeriod' name='strCWarrantyPeriod' value='" + $("#id_Warranty_DWarrantyPeriod").val() + "'></td>" +
            "<td class='WarrantySDate'>" + $("#id_Warranty_DWarrantySDate").val() + "<input type='hidden' class='strCWarrantySDate' name='strCWarrantySDate' value='" + $("#id_Warranty_DWarrantySDate").val() + "'></td>" +
            "<td class='WarrantyEDate'>" + $("#id_Warranty_DWarrantyEDate").val() + "<input type='hidden' class='strCWarrantyEDate' name='strCWarrantyEDate' value='" + $("#id_Warranty_DWarrantyEDate").val() + "'></td>" +
            "<td class='WarrantyType'>" + $("#id_Warranty_DWarrantyType").val() + "<input type='hidden' class='strCWarrantyType' name='strCWarrantyType' value='" + $("#id_Warranty_DWarrantyType").val() + "'></td>" +
            "<td class='remark'>" + $("#id_Warranty_DRemark").val() + "<input type='hidden' class='strCRemark' name='strCRemark' value='" + $("#id_Warranty_DRemark").val() + "'></td>" +
            "</tr>");

        $(".Warranty_D-modal").modal("hide");
    };

    function updateProductDWarrantyEDate() {

        if ($("#id_WarrantyPeriod").val() == "") {
            $("#id_WarrantyPeriod").val("0");
        }
        if ($("#id_WarrantySDate").val() == "") {
            return;
        }
        if ($("#id_WarrantyPeriod").val() == "0") {
            $("#id_WarrantyEDate").val($("#id_WarrantySDate").val());
            return;
        }
        $("#id_WarrantyEDate").val(EDate($("#id_WarrantySDate").val(), $("#id_WarrantyPeriod").val()));
    };

    function SelectCustomer(id) {
        $("#id_CustomerId").val($(id).closest('tr').find(".CustomerIdType").html());        //客戶代號
        $("#customername").html($(id).closest('tr').find(".CustomerNameType").html());     //客戶名稱
        $("#id_CustomerType").val($(id).closest('tr').find(".CustomerTypeType").html());     //客戶形態
        $("#id_SourceOrderType").val("");      //來源單別
        $("#id_SourceOrderNo").val("");    //來源單號
        $("#id_SourceOrderItemId").val("");    //來源項次
        $("#id_SerialNo").val("");      //序號
        $("#id_ProductNo").val("");    //品號
        $("#id_ProductName").val("");    //品名
        $("#id_RoutineServiceFreq").val("");    //定期保養
        $("#id_WarrantyPeriod").val("");    //保固期限
        $("#id_WarrantySDate").val("");    //保固起日
        $("#id_WarrantyEDate").val("");    //保固迄日
    };

    function SelectVendor(id) {
        $("#id_Warranty_DTargetId").val($(id).closest('tr').find(".vendorIdType").html());      //廠商代號
        $("#id_Warranty_DTargetName").val($(id).closest('tr').find(".vendorNameType").html());    //廠商簡稱
        $('.choose-modal').modal("hide");
    }

    function SelectContractType(id) {
        $("#id_SourceOrderType").val($(id).closest('tr').find(".ContractTypeType").html());      //來源單別
        $("#id_SourceOrderNo").val($(id).closest('tr').find(".ContractNoType").html());    //來源單號
        $("#id_SourceOrderItemId").val("");    //來源項次
        $("#id_CustomerId").val($(id).closest('tr').find(".CustomerIdType").html());        //客戶代號
        $("#customername").html($(id).closest('tr').find(".CustomerNameType").html());     //客戶名稱
        $("#id_CustomerType").val($(id).closest('tr').find(".CustomerTypeType").html());     //客戶形態
        $('.record-selector-Contract-modal').modal("hide");
    }

    function SelectSerialNo(id) {
        $("#id_SourceOrderItemId").val($(id).closest('tr').find(".ItemIdType").html());    //來源項次
        $("#id_SerialNo").val($(id).closest('tr').find(".SerialNoType").html());      //序號
        $("#id_ProductNo").val($(id).closest('tr').find(".ProductNoType").html());    //品號
        $("#id_ProductName").val($(id).closest('tr').find(".ProductNameType").html());    //品名
        $("#id_RoutineServiceFreq").val($(id).closest('tr').find(".RoutineServiceFreqType").html());    //定期保養
        $("#id_WarrantyPeriod").val($(id).closest('tr').find(".WarrantyPeriodType").html());    //保固期限
        $("#id_WarrantySDate").val($(id).closest('tr').find(".WarrantySDateType").html());    //保固起日
        $("#id_WarrantyEDate").val($(id).closest('tr').find(".WarrantyEDateType").html());    //保固迄日
        $("#id_CustomerId").val($(id).closest('tr').find(".TargetIdType").html());        //客戶代號
        $("#customername").html($(id).closest('tr').find(".TargetNameType").html());     //客戶名稱
        if ($(id).closest('tr').find(".WarrantyTypeType").html() == "2.客戶")
        {
            $("#id_SaleDate").val($(id).closest('tr').find(".ChangeDateType").html())
        }
        
        $('.record-selector-ContractSerial-modal').modal("hide");
    }

    function SelectProductSerialNo(id) {
        $("#id_SourceOrderItemId").val($(id).closest('tr').find(".ItemIdType").html());    //來源項次
        $("#id_SerialNo").val($(id).closest('tr').find(".SerialNoType").html());      //序號
        $("#id_ProductNo").val($(id).closest('tr').find(".ProductNoType").html());    //品號
        $("#id_ProductName").val($(id).closest('tr').find(".ProductNameType").html());    //品名
        $("#id_RoutineServiceFreq").val($(id).closest('tr').find(".RoutineServiceFreqType").html());    //定期保養
        $("#id_WarrantyPeriod").val($(id).closest('tr').find(".WarrantyPeriodType").html());    //保固期限
        $("#id_WarrantySDate").val($(id).closest('tr').find(".WarrantySDateType").html());    //保固起日
        $("#id_WarrantyEDate").val($(id).closest('tr').find(".WarrantyEDateType").html());    //保固迄日
        $('.record-selector-ProductSerial-modal').modal("hide");
    }

    function SelectOrderType(id) {
        $("#id_SerArrangeOrderType").val($(id).closest('tr').find(".OrderTypeType").html());
        $("#ordersname").html($(id).closest('tr').find(".OrderSNameType").html());
        $.ajax({
            url: '@Url.Action("GetOrderTypeNo", "Main", new { Area = "SUPI05" })',
            data: JSON.stringify({ "OrderType": $("#id_SerArrangeOrderType").val().trim() }),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                var strData = data.split('-');
                if (strData[0] == "YES") {
                    $('#id_SerArrangeOrderNo').val(strData[1]);
                    document.getElementById("id_SerArrangeOrderNo").readOnly = "readonly";
                } else {
                    $('#id_SerArrangeOrderNo').val(strData[1]);
                    document.getElementById("id_SerArrangeOrderNo").readOnly = "";
                }
            }
        })
    };

    var app = angular.module('myApp', []);
    app.controller('myCtrl', function ($scope, $http) {
        $scope.OrderCategoryitems = null;
        $scope.customeritems = null;
        $scope.OrderCategoryList = function () {
            $http({
                url: '@Url.Action("SearchOrderType", "Main", new { Area = "CONI01" })',
                params: { Col: ",OrderCategory", Condition: ",=", conditionValue: ",D1", Page: 0 }
            }).success(function (data, status) {
                $scope.OrderCategoryitems = data;
            })
        };
        $scope.SearchOrderCategoryList = function () {
            $http({
                url: '@Url.Action("SearchOrderType", "Main", new { Area = "CONI01" })',
                params: { Col: ",OrderCategory," + $("#addOrderCategoryCol").val(), Condition: ",=," + $("#addOrderCategoryCondition").val(), conditionValue: ",D1," + $("#addOrderCategoryconditionValue").val(), Page: 0 }
            }).success(function (data, status) {
                $scope.OrderCategoryitems = data;
            })
        };
        $scope.customerList = function () {
            $http({
                method: 'POST',
                url: '@Url.Action("SearchCustomer", "Main", new { Area = "CONI02" })',
                params: { Col: "", Condition: "", conditionValue: "", Page: 0 }
            }).success(function (data, status) {
                $scope.customeritems = data;
            })
        };
        $scope.SearchcustomerList = function () {
            $http({
                method: 'POST',
                url: '@Url.Action("SearchCustomer", "Main", new { Area = "CONI02" })',
                params: { Col: "," + $("#addCustomer_Col").val(), Condition: "," + $("#addCustomer_Condition").val(), conditionValue: "," + $("#addCustomer_conditionValue").val(), Page: 0 }
            }).success(function (data, status) {
                $scope.customeritems = data;
            })
        };
    });
</script>
<section class="content-header">
    <h1>定保計畫單維護</h1>
</section>
<section class="content" ng-app="myApp" ng-controller="myCtrl">
    <div class="panel panel-default">
        <div class="panel-heading"><i class="fa fa-pencil fa-fw"></i> Application</div>
        <div class="panel-body">
            <form id="from-ServiceArrange" method="post">
                <div class="row">
                    <div class="form-group">
                            <label for="id_SerArrangeOrderType" class="col-md-3 col-lg-3 control-label">計劃單別</label>
                            <div class="col-md-5 col-lg-5">
                                @if (@ViewBag.Type == "Edit" || @ViewBag.Type == "Details")
                                {
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="id_SerArrangeOrderType" name="SerArrangeOrderType" value="@ViewBag.SerArrangeOrderType" readonly />
                                        <span class="input-group-addon" style="cursor:pointer;"><span class="fa fa-hand-pointer-o"></span></span>
                                    </div>
                                }
                                else
                                {
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="id_SerArrangeOrderType" name="SerArrangeOrderType" value="@ViewBag.SerArrangeOrderType" maxlength="5" tabindex="1"/>
                                        <span class="input-group-addon" id="btnSerArrangeOrderType" style="cursor:pointer;" data-toggle="modal" data-target="#modal-orderCategory" ng-click="OrderCategoryList()" tabindex="2"><span class="fa fa-hand-pointer-o"></span></span>
                                    </div>
                                }
                                <span style="display:inline;" id="ordersname">@ViewBag.OrderSName</span>
                            </div>
                            <label for="id_OrderDate" class="col-md-3 col-lg-3 control-label">單據日期</label>
                            @if (ViewBag.Type == "Details")
                            {
                                <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_OrderDate" data-link-format="yyyy/mm/dd">
                                    <div class="input-group">
                                        <input type="text" class="form-control" name="OrderDate" readonly="readonly" value="@ViewBag.OrderDate" />
                                        <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_OrderDate" data-link-format="yyyy/mm/dd">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="id_OrderDate" name="OrderDate" readonly="readonly" value="@ViewBag.OrderDate" tabindex="3"/>
                                        <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                    </div>
                                </div>
                            }
                            <label for="id_Confirmed" class="col-md-3 col-lg-3 control-label">狀態碼</label>
                            <div class="col-md-5 col-lg-5">
                                <input type="text" class="form-control" id="id_Confirmed" name="Confirmed" value="@ViewBag.Confirmed" readonly/>
                            </div>
                        </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="id_SerArrangeOrderNo" class="col-md-3 col-lg-3 control-label">計畫單號</label>
                        <div class="col-md-5 col-lg-5">
                            @if (@ViewBag.Type == "Edit" || @ViewBag.Type == "Details")
                            {
                                <input type="text" class="form-control" id="id_SerArrangeOrderNo" name="SerArrangeOrderNo" value="@ViewBag.SerArrangeOrderNo" readonly/>
                            }
                            else
                            {
                                <input type="text" class="form-control" id="id_SerArrangeOrderNo" name="SerArrangeOrderNo" value="@ViewBag.SerArrangeOrderNo" maxlength="20" tabindex="4"/>
                            }
                        </div>
                        <label for="id_CustomerId" class="col-md-3 col-lg-3 control-label">客戶代號</label>
                        <div class="col-md-5 col-lg-5">
                            @if (@ViewBag.Type == "Edit" || @ViewBag.Type == "Details")
                            {
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_CustomerId" name="CustomerId" value="@ViewBag.CustomerId" readonly />
                                    <span class="input-group-addon" style="cursor:pointer;"><span class="fa fa-hand-pointer-o"></span></span>
                                </div>
                            }
                            else
                            {
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_CustomerId" name="CustomerId" value="@ViewBag.CustomerId" maxlength="10" tabindex="5"/>
                                    <span class="input-group-addon" id="btnCustomerId" style="cursor:pointer;" data-toggle="modal" data-target="#modal-customer" ng-click="customerList()" tabindex="6"><span class="fa fa-hand-pointer-o"></span></span>
                                </div>
                            }
                            <span style="display:inline;" id="customername">@ViewBag.CustomerName</span>
                        </div>

                        <label for="id_CustomerType" class="col-md-3 col-lg-3 control-label">客戶形態</label>
                        <div class="col-md-5 col-lg-5">
                            <input type="text" class="form-control" id="id_CustomerType" name="CustomerType" value="@ViewBag.CustomerType" readonly/>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="id_SourceOrder" class="col-md-3 col-lg-3 control-label">來源單號</label>
                        <div class="col-md-13 col-lg-13">
                            <input type="text" class="form-control" id="id_SourceOrderType" name="SourceOrderType" style="width: 30%; display: inline;" value="@ViewBag.SourceOrderType" readonly />
                            <input type="text" class="form-control" id="id_SourceOrderNo" name="SourceOrderNo" style="width: 35%; display: inline;" value="@ViewBag.SourceOrderNo" readonly />
                            <input type="text" class="form-control" id="id_SourceOrderItemId" name="SourceOrderItemId" style="width: 30%; display: inline;" value="@ViewBag.SourceOrderItemId" readonly />
                        </div>
                        <label for="id_Version" class="col-md-3 col-lg-3 control-label">版次</label>
                        <div class="col-md-5 col-lg-5">
                            <input type="text" class="form-control" id="id_Version" name="Version" value="@ViewBag.Version" readonly />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="id_SerialNo" class="col-md-3 col-lg-3 control-label">序號</label>
                        <div class="col-md-5 col-lg-5">
                            @if (@ViewBag.Type == "Edit" || @ViewBag.Type == "Details")
                            {
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_SerialNo" name="SerialNo" value="@ViewBag.SerialNo" readonly />
                                    <span class="input-group-addon" style="cursor:pointer;"><span class="fa fa-hand-pointer-o"></span></span>
                                </div>
                            }
                            else
                            {
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_SerialNo" name="SerialNo" value="@ViewBag.SerialNo" tabindex="7"/>
                                    <span class="input-group-addon" id="btnSerialNo" style="cursor:pointer;" tabindex="8"><span class="fa fa-hand-pointer-o"></span></span>
                                </div>
                            }

                        </div>
                        <label for="id_ProductNo" class="col-md-3 col-lg-3 control-label">品號</label>
                        <div class="col-md-5 col-lg-5">
                            @if (@ViewBag.Type == "Edit" || @ViewBag.Type == "Details")
                            {
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_ProductNo" name="ProductNo" value="@ViewBag.ProductNo" readonly />
                                    <span class="input-group-addon" style="cursor:pointer;"><span class="fa fa-hand-pointer-o"></span></span>
                                </div>            
                            }
                            else
                            {
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_ProductNo" name="ProductNo" value="@ViewBag.ProductNo" maxlength="40" tabindex="9"/>
                                    <span class="input-group-addon" id="btnProductNo" style="cursor:pointer;" tabindex="10"><span class="fa fa-hand-pointer-o"></span></span>
                                </div>
                            }
                        </div>
                        <label for="id_ProductName" class="col-md-3 col-lg-3 control-label">品名</label>
                        <div class="col-md-5 col-lg-5">
                            <input type="text" class="form-control" id="id_ProductName" name="ProductName" value="@ViewBag.ProductName" readonly />
                        </div>
                    </div>
                    </div>
                <div class="row">
                    <div class="form-group">
                        <label for="id_SaleDate" class="col-md-3 col-lg-3 control-label">銷貨日期</label>
                        @if (ViewBag.Type == "Details")
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_SaleDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="SaleDate" readonly="readonly" value="@ViewBag.SaleDate" />
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_SaleDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_SaleDate" name="SaleDate" readonly="readonly" value="@ViewBag.SaleDate" tabindex="11"/>
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                        <label for="id_RoutineServiceFreq" class="col-md-3 col-lg-3 control-label">定期保養</label>
                        @if (ViewBag.Type == "Details")
                        {
                            <div class="col-md-5 col-lg-5">
                                <input type="text" class="form-control" id="id_RoutineServiceFreq" name="RoutineServiceFreq" style="width: 80%; display: inline;" value="@ViewBag.RoutineServiceFreq" readonly />
                                <span>次</span>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-5 col-lg-5">
                                <input type="text" class="form-control" id="id_RoutineServiceFreq" name="RoutineServiceFreq" style="width: 80%; display: inline;" value="@ViewBag.RoutineServiceFreq" onkeydown="onlyNumber()" maxlength="3" tabindex="12" />
                                <span>次</span>
                            </div>
                        }
                        <label for="id_ConfirmedDate" class="col-md-3 col-lg-3 control-label">計劃日期</label>
                        @if (ViewBag.Type == "Details")
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_ConfirmedDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="ConfirmedDate" readonly="readonly" value="@ViewBag.ConfirmedDate" />
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_ConfirmedDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="ConfirmedDate" readonly="readonly" value="@ViewBag.ConfirmedDate" />
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                    </div>

                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="id_WarrantyPeriod" class="col-md-3 col-lg-3 control-label">保固期限</label>
                        <div class="col-md-5 col-lg-5">
                        @if (ViewBag.Type == "Details")
                        {
                            <input type="text" class="form-control" id="id_WarrantyPeriod" name="WarrantyPeriod" style="width: 80%; display: inline;" value="@ViewBag.WarrantyPeriod" readonly/>
                            <span>月</span>
                        }
                        else
                        {
                            <input type="text" class="form-control" id="id_WarrantyPeriod" name="WarrantyPeriod" style="width: 80%; display: inline;" value="@ViewBag.WarrantyPeriod" onchange="updateProductDWarrantyEDate()"  onkeydown="onlyNumber()" tabindex="13"/>
                            <span>月</span>
                        }
                        </div>
                        <label for="id_WarrantySDate" class="col-md-3 col-lg-3 control-label">保固起日</label>
                        @if (ViewBag.Type == "Details")
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_WarrantySDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="WarrantySDate" readonly="readonly" value="@ViewBag.WarrantySDate" />
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_WarrantySDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_WarrantySDate" name="WarrantySDate" readonly="readonly" value="@ViewBag.WarrantySDate" onchange="updateProductDWarrantyEDate()" tabindex="14"/>
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                        <label for="id_WarrantyEDate" class="col-md-3 col-lg-3 control-label">保固迄日</label>
                        @if (ViewBag.Type == "Details")
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_WarrantyEDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" name="WarrantyEDate" readonly="readonly" value="@ViewBag.WarrantyEDate" />
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="col-md-5 col-lg-5 date" data-date="" data-date-format="yyyy/mm/dd" data-link-field="id_WarrantyEDate" data-link-format="yyyy/mm/dd">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="id_WarrantyEDate" name="WarrantyEDate" readonly="readonly" value="@ViewBag.WarrantyEDate" tabindex="15"/>
                                    <span class="input-group-addon" id="basic-addon2"><span class="glyphicon glyphicon-calendar"></span></span>
                                </div>
                            </div>
                        }
                    </div>

                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="id_Remark" class="col-md-3 col-lg-3 control-label">備註</label>
                        <div class="col-md-13 col-lg-13">
                            @if (@ViewBag.Type == "Details")
                            {
                                <textarea class="form-control" id="id_Remark" name="Remark" cols="40" rows="5" maxlength="255" readonly>@ViewBag.Remark</textarea>
                            }
                            else
                            {
                                <textarea class="form-control" id="id_Remark" name="Remark" cols="40" rows="5" maxlength="255" tabindex="16">@ViewBag.Remark</textarea>
                            }
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="form-group">
                        <label for="id_InternalRemark" class="col-md-3 col-lg-3 control-label">內部備註</label>
                        <div class="col-md-13 col-lg-13">
                            @if (@ViewBag.Type == "Details")
                            {
                                <textarea class="form-control" id="id_InternalRemark" name="InternalRemark" cols="40" rows="5" maxlength="255" readonly>@ViewBag.InternalRemark</textarea>
                            }
                            else
                            {
                                <textarea class="form-control" id="id_InternalRemark" name="InternalRemark" cols="40" rows="5" maxlength="255" tabindex="17">@ViewBag.InternalRemark</textarea>
                            }
                        </div>
                    </div>

                </div>    
                      
                <h5>保固明細</h5>
                <div class="text-right">
                                @if (@ViewBag.Type == "Details")
                                {
                                    <button type="button" class="btn btn-primary" id="btnServiceArrange_D" name="action" value="btnServiceArrange_D" aria-label="Left Align"  disabled>
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 產生計劃明細
                                    </button>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-primary" id="btnServiceArrange_D" name="action" value="btnServiceArrange_D" aria-label="Left Align" tabindex="18">
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 產生計劃明細
                                    </button>
                                }
                                @if (@ViewBag.Type == "Details")
                                {
                                    <button type="button" class="btn btn-primary" id="btnCleanServiceArrange_D" name="action" value="btnCleanServiceArrange_D" aria-label="Left Align" disabled>
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 清除計劃明細
                                    </button>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-primary" id="btnCleanServiceArrange_D" name="action" value="btnCleanServiceArrange_D" aria-label="Left Align" tabindex="19" disabled>
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 清除計劃明細
                                    </button>
                                }
                            </div>
                <hr />
                <div id="divServiceArrange_DGrid" style="height: 100px;overflow-y: auto;">
                                @{
                                    var webGrid = new WebGrid(source: (IEnumerable<BusinessLayer.Models.ServiceArrange_D>)ViewData["ServiceArrange_D"], canPage: false, canSort: false, ajaxUpdateContainerId: "divServiceArrange_DGrid");
                                }
                                @webGrid.GetHtml(

                                    tableStyle: "table table-striped table-hover",
                                    columns: webGrid.Columns(
                                        webGrid.Column(columnName: "", header: "動作", style: "actioncolumn",
                                            format:
                                            @<text>
                                                @if (@ViewBag.Type == "Details")
                                                {
                                                    <a>編輯</a><a>刪除</a>
                                                }
                                                else
                                                {
                                                    <a onclick='ProductDExit(this)' href="#">編輯</a><a onclick='RemoveProcess(this)' href="#">刪除</a>
                                                }
                                            </text>),
                                            webGrid.Column(columnName: "ItemId", header: "項次", style: "ItemId",
                                            format:
                                            @<text>
                                                @item.ItemId
                                                <input type="hidden" class="strCItemId" name="strCItemId" value='@item.ItemId' tabindex="10">
                                            </text>),
                                            webGrid.Column(columnName: "ArrangeMonth", header: "保養月份", style: "ArrangeMonth",
                                            format:
                                            @<text>
                                                @item.ArrangeMonth
                                                <input type="hidden" class="strCArrangeMonth" name="strCArrangeMonth" value='@item.ArrangeMonth' tabindex="11">
                                            </text>),
                                            webGrid.Column(columnName: "AddressSName", header: "地址簡稱", style: "AddressSName",
                                            format:
                                            @<text>
                                                @item.AddressSName
                                                <input type="hidden" class="strCAddressSName" name="strCAddressSName" value='@item.AddressSName' tabindex="12">
                                            </text>),
                                            webGrid.Column(columnName: "Address", header: "地址", style: "Address",
                                            format:
                                            @<text>
                                                @item.Address
                                                <input type="hidden" class="strCAddress" name="strCAddress" value='@item.Address' tabindex="13">
                                            </text>),
                                            webGrid.Column(columnName: "IsClosed", header: "結案碼", style: "IsClosed",
                                            format:
                                            @<text>
                                                @item.IsClosed
                                                <input type="hidden" class="strCIsClosed" name="strCIsClosed" value='@item.IsClosed' tabindex="14">
                                            </text>),
                                            webGrid.Column(columnName: "DRemark", header: "單身備註", style: "DRemark",
                                            format:
                                            @<text>
                                                @item.Remark
                                                <input type="hidden" class="strCRemark" name="strCRemark" value='@item.Remark' tabindex="15">
                                            </text>)
)
)
                            </div>

                <p style="color: red;">@ViewBag.Msg</p>
                <input type="hidden" class="form-control" id="AutoConfirm" name="AutoConfirm" readonly />
                <input type="hidden" class="form-control" id="CheckExOrder" name="CheckExOrder" readonly />
                <div class="text-right">
                            @if (@ViewBag.Type == "Edit")
                            {
                                <button type="button" class="btn btn-primary" name="action" value="Edit" onclick="btnExit()" tabindex="20">存檔</button>
                                <button type="button" class="btn btn-primary" name="action" value="EditAgain" onclick="btnExitAgain()" tabindex="21">存檔並新增</button>
                                <a class="btn btn-primary" href="@Url.Action("Index", "Main", null)" tabindex="22">取消</a>
                            }
                            else if (@ViewBag.Type == "Details")
                            {
                                <a class="btn btn-primary" href="@Url.Action("Tree", "Main", new { SerArrangeOrderType = @ViewBag.SerArrangeOrderType, SerArrangeOrderNo = @ViewBag.SerArrangeOrderNo })" tabindex="20">串查</a>
                                if (@ViewBag.Confirmed.Substring(0, 1) == "N")
                                {
                                    <a class="btn btn-primary" href="@Url.Action("Edit", "Main", new { SerArrangeOrderType = @ViewBag.SerArrangeOrderType, SerArrangeOrderNo = @ViewBag.SerArrangeOrderNo })" tabindex="21">編輯</a>
                                }
                                <a class="btn btn-primary" href="@Url.Action("Copy", "Main", new { SerArrangeOrderType = @ViewBag.SerArrangeOrderType, SerArrangeOrderNo = @ViewBag.SerArrangeOrderNo })" tabindex="22">複製並新增</a>
                                if (@ViewBag.Confirmed.Substring(0, 1) == "Y")
                                {
                                    <a class="btn btn-primary" href="@Url.Action("Confirmed", "Main", new { SerArrangeOrderType = @ViewBag.SerArrangeOrderType, SerArrangeOrderNo = @ViewBag.SerArrangeOrderNo, type = 'N' })" tabindex="23">取消確認</a>
                                }
                                if (@ViewBag.Confirmed.Substring(0, 1) == "N")
                                {
                                    <a class="btn btn-primary" href="@Url.Action("Confirmed", "Main", new { SerArrangeOrderType = @ViewBag.SerArrangeOrderType, SerArrangeOrderNo = @ViewBag.SerArrangeOrderNo, type = 'Y' })" tabindex="24">確認</a>
                                    <a class="btn btn-primary" onclick="deleteInfo('@Url.Action("Delete", "Main", new { SerArrangeOrderType = @ViewBag.SerArrangeOrderType, SerArrangeOrderNo = @ViewBag.SerArrangeOrderNo })', '@ViewBag.SerArrangeOrderNo')" tabindex="25">刪除</a>
                                    <a class="btn btn-primary" href="@Url.Action("Confirmed", "Main", new { SerArrangeOrderType = @ViewBag.SerArrangeOrderType, SerArrangeOrderNo = @ViewBag.SerArrangeOrderNo, type = 'V' })" tabindex="26">作廢</a>
                                }
                                <a class="btn btn-primary" href="@Url.Action("Index", "Main", null)" tabindex="27">返回列表</a>
                            }
                            else
                            {
                                <button type="button" class="btn btn-primary" name="action" value="Save" onclick="btnAdd()" tabindex="20">存檔</button>
                                <button type=button class="btn btn-primary" name="action" value="SaveAgain" onclick="btnAddAgain()" tabindex="21">存檔並新增</button>
                                <button type="button" class="btn btn-primary" name="action" id="btnCopyOrder" tabindex="22">複製前單</button>
                                <a class="btn btn-primary" href="@Url.Action("Index", "Main", null)" tabindex="23">取消</a>
                            }

                </div>
            </form>
        </div>
    </div>
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_OrderCategory.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_customer.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_contract_h.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_contract_product.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_ContractSerial.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_ProductSerial.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/delete-dialog.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_product.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/msg-dialog.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_WarrantySerial.cshtml")
    @RenderPage("~/Areas/PMAI02/Views/Shared/Warranty_D-modal.cshtml")
    @RenderPage("~/Areas/PMAI02/Views/Shared/choose-modal.cshtml")
    @RenderPage("~/Areas/PMAI02/Views/Shared/ServiceArrange_D-modal.cshtml")
    @RenderPage("../../../../Views/Shared/RecordSelector/record_selector_address.cshtml")

</section>
<input type="hidden" title="module" value="PMAI02" />
